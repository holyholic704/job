## 文件与目录

### 一切皆文件

在 Linux 操作系统中，所有被操作系统管理的资源，例如网络接口卡、磁盘驱动器、打印机、输入输出设备、普通文件或是目录都被看作是一个文件。**也是 Linux 系统中一个重要的概念**



### 文件属性

> **`drwxr-xr-x.   5   root   root   2046   May   29   16:08   .config`**
>
> **`-rw-------.   1   root   root    176   Apr    2   19:14   wlgq`**
>
> **`-rw-r--r--.   1   root   root     18   Dec   28    2013   .bashrc`**
>
> ①——————   ②      ③—       ④—        ⑤—      ⑥————————      ⑦———



#### ①：文件的类型与权限

![1555069133774](../md.assets/1555069133774.png)

- 第一组为 **文件拥有者可具备的权限**（user）
- 第二组为 **加入此群组之账号的权限**（group）
- 第三组为 **非本人且没有加入本群组之其他账号的权限**（others）
- **超级用户root具有一切权限**



| 文件类型标识 |                           文件类型                           |
| :----------: | :----------------------------------------------------------: |
|    **-**     |                         **普通文件**                         |
|    **d**     |                           **目录**                           |
|    **l**     |           **链接文件**，类似Windows下面的快捷方式            |
|    **s**     | **套接字文件**，这类文件通常用在网络数据连接，可以启动一个程序来监听客户端的要求，客户端就可以通过套接字来进行数据通信 |
|    **b**     | **块设备文件**，存储数据以供系统存取的接口设备，简单而言就是硬盘 |
|    **c**     |      **字符设备**，串行端口的接口设备，如键盘、鼠标等等      |
|    **p**     | **管道文件（FIFO）**，是一种特殊的文件类型，Linux系统下，进程之间通信可以通过该文件完成 |



#### ②：表示有多少档名连结到此节点(i-node)

- 每个文件都会将他的权限与属性记录到文件系统的 i-node 中，不过，我们使用的目录树却是使用文件名来记录， 因此每个档名就会连结到一个 i-node 。这个属性记录的，就是有多少不同的档名连结到相同的一个 i-node 号码去就是了



#### ③：文件的拥有者账号

#### ④：文件所属的群组

#### ⑤：文件的容量大小

#### ⑥：最近的修改日期

#### ⑦：文件的档名

- 文件或者目录



### 改变文件属性与权限

```bash
# change group，改变所属群组
chgrp [群组名] [文件]

# 进行递归的持续变更，即同目录下的所有文件都更新成为这个群组。常常用在变更某一目录内所有的文件的情况
chgrp -R [群组名] [文件]
```

```bash
# change owner，改变文件拥有者
chown [账号名] [文件]

# 改变文件拥有者和所属群组
chown [账号名:群组] [文件]

# 进行递归的持续变更
chown -R [账号名] [文件]
```

```bash
# change mode，改变权限
chomod [权限] [文件]

# 进行递归的持续变更
chomod -R [权限] [文件]

# 数字类型改变文件权限，权限分数对照：r:4、w:2、x:1
# 如将test文件的权限-rwxrwxrwx修改为-rwxr-xrw-
chomod 756 test

# 符号类型改变文件权限，权限身份对照：u:user、g:group、o:others、a:all
# u/g/o可以连写，如u=rx,go-rwx、ugo=rwx
# 运算符对照：+:加入权限、-:去除权限、=:设定权限
# 如将test文件的权限-rwxrwx---修改为-rwxrw---x
chomod u=rwx,g-x,o+x test
```



### rwx

- **文件**
  - **r (read)**：可读取此文件的实际内容，如读取文本文件的文字内容等
  - **w (write)**：可以编辑、新增或者是修改该文件的内容（但不含删除该文件）
  - **x (execute)**：该文件具有可以被系统执行的权限
- **目录**
  - **r (read contents in directory)**：表示具有读取目录结构列表的权限
  - **w (modify contents of directory)**：表示具有异动该目录结构列表的权限
    - 建立新的文件与目录
    - 删除已经存在的文件与目录（不论该文件的权限为何）
    - 将已存在的文件或目录进行更名
    - 移动该目录内的文件或目录的位置
  - **x (access directory)**：目录的 x 代表的是用户能否进入该目录成为工作目录（work directory）就是你
    目前所在的目录
    - 能不能进入一个目录，只与x权限有关，即使具有该目录的r或w权限
  - 如果用户具有某个目录的rwx权限，没有里面某个文件的rwx权限，用户无法读写或执行该文件，但是可以删除该文件



### 文件的默认权限和隐藏权限（待添加）



### 指令与文件的搜寻

```bash
# 搜索指令
which [指令]

# 将所有由 PATH 目录中可以找到的指令均列出，而不止第一个被找到的指令名称
which -a [指令]
```

```bash
# 指令的搜索，只搜索特定目录/bin/sbin、/usr/share/man
whereis [指令]

# 列出whereis会去查询的几个主要目录
whereis -l [指令]

# 只找binary格式的文件
whereis -b [指令]

# 只找在说明文件manual路径下的文件
whereis -m [指令]

# 只找source来源文件
whereis -s [指令]

# 搜寻不在上述三个项目当中的其他特殊文件
whereis -u [指令]
```

```bash
# 可以用关键字或者正则表达式进行搜索 
locate
```



- **`locate`**：
  - **`locate -i [关键字]`**：忽略大小写的差异
  - **`locate -c [关键字]`**：不输出档名，仅计算找到的文件数量
  - **`locate -l [行数] [关键字]`**：只输出几行的意思
  - **`locate -r [关键字]`**：接正则表达式
  - **`updatedb`**：更新数据库，**`locate`**无法搜索新建的文件（默认一天更新一次）



```bash
# 可以使用文件的属性和权限进行搜索
find 
```



- **`find`**：
  - **`find [目录] [选项] [参数]`**：使用文件的属性和权限进行搜索
  - 与时间有关的选项**`-atime`**、**`-ctime`**、**`-mtime`**，以**`-mtime`**为例
    - **`find [目录] -mtime n`**：列出在 n 天之前的一天之内被修改过内容的文件
      - **`find [目录] -mtime 0`**：0表示当前时间，该指令表示现在到24小时之前被修改过的文件
    - **`find [目录] -mtime +n`**：列出在 n 天之前，不含当天，被修改过内容的文件
    - **`find [目录] -mtime -n`**：列出在 n 天之内，含当天，被修改过内容的文件
    - **`find [目录] -mtime -newer [文件]`**：列出比某个文件还要新的文件
  - ![1555219150337](../md.assets/1555219150337.png)
  - 与文件拥有者和所属群组有关的选项
    - **`find [目录] -uid [UID]`**：列出属于 UID 为 n 的文件
    - **`find [目录] -gid [GID]`**：列出属于 GID 为 n 的文件
    - **`find [目录] -user [用户名]`**：列出属于该用户的文件
    - **`find [目录] -group [群组名]`**：列出属于该群组的文件
    - **`find [目录] -nouser`**：列出不属于任何用户的文件
    - **`find [目录] -nogroup`**：列出不属于任何群组的文件
  - 与文件权限和名称有关的选项
    - **`find [目录] -name [文件名]`**：按文件名搜索文件
    - **`find [目录] -size [+-][文件大小]`**：搜寻比某个文件容量还要大(+)或小(-)的文件
    - **`find [目录] -type [文件类型]`**：按文件类型搜索文件
    - **`find [目录] -perm [文件权限]`**：搜索等于权限的文件
    - **`find [目录] -perm -[文件权限]`**：搜索包括权限的文件
    - **`find [目录] -perm /[文件权限]`**：搜索包括任一权限的文件



### 文件的管理

- **`ls`**：list的缩写，文件的检视，默认按档名进行排序
  - **`ls -a [文件]`**：全部的文件，连同隐藏档（开头为 . 的文件）一起列出来，常用
  - **`ls -A [文件]`**：全部的文件，连同隐藏档一起列出来，不包括**`.`**与**`..`**两个目录
  - **`ls -d [文件]`**：只列出目录本身，不列出目录内的文件数据，常用
  - **`ls -f [文件]`**：只列出结果，不进行排序
  - **`ls -F [文件]`**：根据文件、目录等信息，给予附加数据结构
  - **`ls -i [文件]`**：列出 inode 号码
  - **`ls -l [文件]`**：长数据串行出，包含文件的属性与权限等等数据，常用
  - **`ls -r [文件]`**：将排序结果反向输出
  - **`ls -R [文件]`**：连同子目录内容一起列出来，该目录下的所有文件都会显示出来
  - **`ls -S [文件]`**：按文件容量大小排序
  - **`ls -t [文件]`**：按时间排序
- **`cp`**：copy的缩写，复制文件
  - **`cp [来源文件] [目标文件]`**：复制来源文件到目标文件，同时复制执行者的属性和权限
  - **`cp -a [来源文件] [目标文件]`**：相当于 **`-dr --preserve=all`** 的意思，常用
  - **`cp -d [来源文件] [目标文件]`**：若来源文件为链接文件，则复制链接文件属性而非文件本身
  - **`cp -f [来源文件] [目标文件]`**：若目标文件已经存在且无法开启，则移除后再尝试一次
  - **`cp -i [来源文件] [目标文件]`**：若目标文件已经存在时，在覆盖前会先询问
  - **`cp -p [来源文件] [目标文件]`**：连同文件的属性一起复制过去，而非使用默认属性，备份常用
  - **`cp -r [来源文件] [目标文件]`**：递归持续复制，常用
  - **`cp -s [来源文件] [目标文件]`**：复制成为符号链接文件，即快捷方式文件
  - **`cp -u [来源文件] [目标文件]`**：目标文件比来源文件旧或目标文件不存在才进行更新
  - **`cp --preserve=all [来源文件] [目标文件]`**：除了 -p 的权限相关参数外，还加入 SELinux 的属性, links, xattr 等也复制了
  - 来源文件有两个以上时，目标文件必须是目录
- **`rm`**：remove的缩写，移除文件
  - **`rm [文件]`**：移除文件
  - **`rm -f [文件]`**：忽略不存在的文件，不会出现警告讯息
  - **`rm -i [文件]`**：删除前会先询问
  - **`rm -r [文件]`**：递归删除，非常危险
- **`mv`**：move的缩写，移动文件、更名
  - **`mv [来源文件] [目标文件]`**：移动来源文件到目标文件
  - **`mv -f [来源文件] [目标文件]`**：如果目标文件已经存在，不会询问直接覆盖
  - **`mv -i [来源文件] [目标文件]`**：移动前会先询问
  - **`mv -u [来源文件] [目标文件]`**：如果目标文件已经存在，并且来源文件比较新，才会更新
  - 来源文件有两个以上时，目标文件必须是目录



### 文件内容的查阅

```bash
# concatenate，检视文件内容
cat

# 相当于-vET的整合选项，可列出一些特殊字符
cat -A [文件]

# 列出行号，仅针对非空白行做行号显示，空白行不标行号
cat -b [文件]

# 将结尾的断行字符$显示出来
cat -E [文件]

# 打印出行号，连同空白行也会有行号
cat -n [文件]

# 将tab按键以^I显示出来
cat -T [文件]

# 列出一些看不出来的特殊字符
cat -v [文件]
```

```bash
# cat的反向操作，从最后一行开始打印

```

```bash
# 可翻页检视，只能向下翻页
more
```

```bash
# 可翻页检视，可以上下翻页
less
```



### 资料撷取

- **`head`**：可以取得文件前几行
  - **`head -n [行数] 文件`**：取得文件前多少行
- **`tail`**：是**`head`**的反向操作，取得文件的后几行
- **`od`**：可以以字符或者十六进制的形式显示二进制文件
- **`touch`**：修改文件时间或者建立新文件
  - **`touch [文件]`**：新建一个空文件
  - **`touch -a [文件]`**：只修改 atime
  - **`touch -c [文件]`**：更新 ctime，若该文件不存在则不建立新文件
  - **`touch -m [文件]`**：只修改 mtime
  - **`touch -d [文件]`**：后面可以接更新日期而不使用当前日期，也可以使用 **`--date="日期或时间"`**
  - **`touch -t [文件]`**：后面可以接更新时间而不使用当前时间，格式为 [YYYYMMDDhhmm]
  - 变动时间
    - **mtime（modification time ）**：当该文件的内容数据变更时，就会更新这个时间。内容数据指的是文件的内容，而不是文件的属性和权限
    - **ctime（status time）**：当该文件的状态改变时，就会更新这个时间，如权限或属性被更改
    - **atime（access time）**：当该文件的内容被取用时，就会更新这个读取时间



### 常见目录

![root](../md.assets/root.png)



### 相对路径和绝对路径

- 绝对路径：由根目录**`/`**开始写起的文件名或目录名称， 如**` /home/test`**
- 相对路径：相对于目前路径的文件名写法，如 **` ./home/test`**或 **` ../../home/test`** 等等。开头不是**` /`**就属于相对路径的写法
  - **`.`**：代表当前的目录，也可以使用**`./`**来表示
  - **`..`**：代表上一层目录，也可以使用**`../`**来表示
  - **`-`**：代表前一层目录
  - **`~`**：代表当前用户的家目录
  - **`~[用户名]`**：代表用户的家目录



### 目录的相关操作

```bash
# change directory，变换目录
cd [目录名称]
```

```bash
# print working directory，显示目前所在的目录
pwd
```

```bash
# make directory，建立新目录
mkdir

# 递归建立目录，如mkdir -p t1/t2/t3
mkdir -p [目录名称]

# 建立目录时配置文件的权限，如mkdir -m 770 test
mkdir -m [目录名称]
```

```bash
# remove directory，删除空目录
rmdir [目录名称]

# 连同上层的空目录一同删除
rmdir -p [目录名称]
```

